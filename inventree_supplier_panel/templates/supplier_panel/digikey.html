{% load i18n %}

<script>
async function JTransferCart(){
    response = await fetch( "{% url 'plugin:suppliercart:transfer-cart' order.pk %}");
    location.reload();
}
async function JCreateToken(){
    const client_id= '{{ plugin.digikey_client_id }}'
    const URL='https://api.digikey.com/v1/oauth2/authorize?response_type=code&client_id=' + client_id + '&redirect_uri=https://192.168.1.40:8123/plugin/suppliercart/digikeytoken/'
    window.open(URL, '_blank', 'location=yes,height=800,width=1400,scrollbars=yes,status=yes')
    location.reload();
}
</script>

<button type='button' class='btn btn-dark' onclick="JTransferCart()" title='{% trans "Transfer PO into Mouser shopping cart" %}'>
<span class='fas fa-redo-alt'></span> {% trans "Transfer PO" %}
</button>

<button type='button' class='btn btn-dark' onclick="JCreateToken()" title='{% trans "Create Token" %}'>
<span class='fas fa-redo-alt'></span> {% trans "Create Token" %}
</button>

{% if plugin.cart_content.status_code == 200 %}
	<div class='alert alert-block alert-info'>
	{{ plugin.cart_content.status_code }} {{ plugin.cart_content.message }}
	</div>
{% else %}
	<div class='alert alert-block alert-danger'>
	{{ plugin.cart_content.status_code }} {{ plugin.cart_content.message }}
	</div>
{% endif %}

Created Digikey list : {{ plugin.cart_content.cart_key }}
<br>

<table class='table table-condensed'>
<thead>
    <tr>
	<td> {% trans "IPN" %} </td>
	<td> {% trans "SKU" %} </td>
	<td> {% trans "Required" %} </td>
	<td> {% trans "Available" %} </td>
	<td> {% trans "Status" %} </td>
	<td align="right"> {% trans "Price" %} </td>
	<td align="right"> {% trans "Total" %} </td>
    </tr>
</thead>
<tbody>
    {% for sub in plugin.cart_content.CartItems %}
    <tr>
	<td> {{ sub.IPN }} </td>
	<td> {{ sub.SKU }} </td>
	<td> {{ sub.QuantityRequested }} </td>
	<td> {{ sub.QuantityAvailable }} </td>
	{% if sub.QuantityRequested > sub.QuantityAvailable %}
            <td><span class='badge badge-left rounded-pill bg-danger'>{% trans "No Stock" %}</span></td>
	{% else %}
            <td><span class='badge badge-left rounded-pill bg-success'>{% trans "OK" %}</span></td>
	{% endif %}
	<td align="right"> {{ sub.UnitPrice|floatformat:4 }} </td>
	<td align="right"> {{ sub.ExtendedPrice|floatformat:4 }} </td>
    <tr>
    {% endfor %}
</tbody>
<tfoot>
    <tr>
	<td> {% trans "Total" %} </td>
	<td> </td>
	<td> </td>
	<td> </td>
	<td> </td>
	<td align="right"> {{ plugin.cart_content.currency_code }} </td>
	<td align="right"> {{ plugin.cart_content.MerchandiseTotal|floatformat:4 }} </td>
	<td> </td>
    </tr>
</tfoot>
</table>

